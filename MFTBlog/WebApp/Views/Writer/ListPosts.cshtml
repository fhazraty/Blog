@{
    ViewData["Title"] = "لیست پست ها";
    Layout = "/Views/Shared/_WriterLayout.cshtml";
}

<div class="mt-4 content" id="dashboard">
    <h2>لیست پست ها</h2>
    <div class="container mt-5">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div><i class="fas fa-table me-1"></i> لیست پست‌ها</div>
                        <div>
                            <a class="btn btn-success btn-sm" href="../../Writer/AddNewPost"><i class="fas fa-plus"></i> افزودن پست جدید</a>
                        </div>
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>ردیف</th>
                                    <th>عنوان پست</th>
                                    <th>نویسنده</th>
                                    <th>دسته‌بندی</th>
                                    <th>تاریخ درج</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="postsTableBody">
                                <!-- Data will be populated here by jQuery -->
                            </tbody>
                        </table>
                        <!-- Pagination -->
                        <nav aria-label="Page navigation example" style="direction:ltr;">
                            <ul class="pagination justify-content-center">
                                <li class="page-item"><a class="page-link" href="#">بعدی</a></li>
                                <li class="page-item"><a class="page-link" href="#">1</a></li>
                                <li class="page-item active"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item"><a class="page-link" href="#">قبلی</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

@section BottomJS
{
    <script>
        $(document).ready(function() {
            $('#postItem').toggleClass('active',500);
            
            getPosts(1,10);
        });
		
        function getPosts(page, perpage) {

            $.ajax({
                url: '/Writer/ListPostsData?page=' + page + "&perpage=" + perpage,
                type: 'POST',
                success: function(data) {
                    var postsTableBody = $('#postsTableBody');
                    debugger;
                    postsTableBody.empty();
                    $.each(data.posts, function(index, post) {
                        var row = '<tr>' +
                            '<td>' + post.rowIndex + '</td>' +
                            '<td>' + post.title + '</td>' +
                            '<td>' + post.authorName + '</td>' +
                            '<td>' + post.categoryName + '</td>' +
                            '<td>' + post.persianInsertationDateTime + '</td>' +
                            '<td>' +
                                '<button class="btn btn-primary btn-sm"><i class="fas fa-edit"></i> ویرایش</button> ' +
                                '<button class="btn btn-danger btn-sm"><i class="fas fa-trash-alt"></i> حذف</button>' +
                            '</td>' +
                            '</tr>';
                        postsTableBody.append(row);
                    });
                },
                error: function() {
                    alert('Error loading posts data.');
                }
            });
		}   
    </script>
}